# 阿里巴巴大数据竞赛算法小结

这几个星期跟@pandana 一起做购买预测，虽然目前成绩还不算好，但也算获益良多，其中尝试了些算法，从最近使用的算法开始往前总结。

## 隐语义模型（Latent Factor Model）

## 时间遗忘

时间遗忘的思想来源于人们的记忆曲线，这里我们使用如下函数计算，用户$u$在时间$t$对品牌$a$的行为对用户在时间$t_e$之后购买品牌的权重

$$\begin{align*}
 w_{u,a,t} &= f - h( t_e-t) \\  
 w_{u,a} &= \sum_{t < t_e}{w_{u,a,t}} = \sum_{t < t_e} { f - h( t_e-t) }
\end{align*}$$

其中$f$和$h$是可调节的参数，当$f=100$和$h=3$时，$w_{u,a,t}$随$t_e-t$变化如下图所示：

![forget_weight][1]

接着，通过限定阈值预测用户$u$是否会购买$a$，

$$ y_{u,a} =
\begin{cases}
1 & \text{ if } w_{u,a}>T \\ 
0 & \text{ if } w_{u,a}\leqslant T 
\end{cases} $$

## 主题建模

一开始和@pandana 是分开做算法。她使用LDA来做，主要的思路是针对购买品牌的行为进行主题挖掘，推测在某一购买行为下哪些品牌同属于一个主题下。在对品牌购买行为进行主题挖掘的过程中有一组用户在各品牌类别下的主题概率，可以根据这个概率高低进行用户相似度的计算，根据用户相似度的高低来排名，将排名高的用户购买的品牌与用户主题概率最高的类别的商品取交集推荐给用户。具体来说：

 * 根据用户ID获取type=1的brand_id，并封装进用户信息中
 * 对brand_id进行统计频率放入三个map中
 * 使用gibbs抽样方法实现brand_id的主题划分
 * 获取user的品牌类别概率，计算用户相似度
 * 根据用户相似度排名，获取相似用户购买频率最高的商品TopN
 * 根据用户品牌类别概率中最高的概率获取该类别的商品品牌TopM
 * 取TopN与TopM的交集

抱歉~@pandana对于她的方法只描述了这么多。提交结果后表示没有命中。原因可能是因为预测的用户太少了。

## 物品相似度

 * F: 1.88%

循着《推荐系统实践》中的方法，我利用物品相似度做购买预测。基本假设是用户的兴趣随时间不发生较大的改变，根据用户已经产生行为的物品，预测用户接下来一个月可能购买的商品。主要分为两步：

 * 根据用户对品牌的行为，计算品牌间的相似度；
 * 计算用户对每个品牌的喜欢程度，取前三作为可能购买的品牌。

直观的想法是如果两个品牌共同被很多用户所喜欢，那么这两个品牌的相似度应该越高。那么可以定义品牌a和品牌b的相似度如下：

$$ w_{ab} = \frac{ | N(a) \cap N(b) | }{ \sqrt{ | N(a) | | N(b) | } } $$

其中$N(a)$表示喜欢品牌a的用户集合。现在问题就在于如何定义“喜欢”，我陆续试了几个方法：

 1. 只要有行为，就算是“喜欢”了；
 2. 只有购买，才算是“真”喜欢；
 3. 由点击数、购买数、收藏数和放进购物车的数量共同加权决定。

这里详细说下第三种方法。考虑到用户可能是先收藏，再放到购物车，最后购买。

$$喜欢程度 = 购买数 + 点击数 \times 0.01  + \max(0, 收藏数 + 购物车数 - 购买数) \times 0.2$$

当用户对品牌的喜欢程度就可能大于1时，用户才算喜欢品牌。在推测出品牌与品牌的相似度后，就可以依据用户的过往行为预测用户可能购买的物品：

$$p_{u,a} = \sum_{b \in N(u) \cap S(a,K)} { w_{ab} } $$

其中$N(u)$表示与用户$u$发生过购买行为的品牌，$S(a,K)$表示和品牌a最相似的物品，$w_{ab}$表示品牌j和品牌i的相似度。公式的直观想法是与用户之前购买过的品牌相似的品牌是用户接下来可能购买的品牌。得到用户对品牌兴趣后，预测较大者可能购买。

方法及公式与 《推荐系统实践》中2.4.2节类同。得到结果有些命中，但其中仍有不少问题，例如：

 * 用户对品牌的喜欢程度的权重公式是经验所得，需要重新考量；
 * 未深入分析用户与品牌的关系，包括热门品牌等；


  [1]: http://images.cnblogs.com/cnblogs_com/siegfang/567372/o_%E6%8D%95%E8%8E%B7.PNG
